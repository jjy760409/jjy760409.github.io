
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AgriNexus Admin Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f8f9fa; }
    h1 { color: #198754; }
    .log { background: white; border-radius: 10px; padding: 10px; margin: 10px 0; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .uid { font-weight: bold; color: #333; }
    .msg { margin-top: 4px; }
    #loginBtn { padding: 10px 20px; font-weight: bold; background: #198754; color: white; border: none; border-radius: 8px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>📊 AgriNexus 관리자 대시보드</h1>
  <button id="loginBtn" onclick="login()">🔐 관리자 로그인 (Google)</button>
  <div id="logs" style="margin-top:20px;"></div>
  <canvas id="langChart" width="400" height="200"></canvas>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDemoKey00000000000000000000000000",
      authDomain: "agrinexus-demo.firebaseapp.com",
      databaseURL: "https://agrinexus-demo-default-rtdb.firebaseio.com",
      projectId: "agrinexus-demo",
      storageBucket: "agrinexus-demo.appspot.com",
      messagingSenderId: "000000000000",
      appId: "1:000000000000:web:demoapp"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    function login() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then((result) => {
          const user = result.user;
          if (!user.email.endsWith("@agrinexus.com")) {
            alert("관리자 전용 접근입니다.");
            return;
          }
          document.getElementById("loginBtn").style.display = "none";
          loadLogs();
        }).catch((error) => {
          console.error(error);
          alert("로그인 실패: " + error.message);
        });
    }

    function loadLogs() {
      db.ref("agrinexus_chat").on("value", snapshot => {
        const logsDiv = document.getElementById("logs");
        logsDiv.innerHTML = "";
        const data = snapshot.val();
        const langStats = { en: 0, ko: 0, ja: 0 };
        for (let uid in data) {
          const userLogs = data[uid];
          for (let key in userLogs) {
            const entry = userLogs[key];
            langStats[entry.lang] = (langStats[entry.lang] || 0) + 1;
            const log = document.createElement("div");
            log.className = "log";
            log.innerHTML = `
              <div class="uid">👤 사용자: ${uid}</div>
              <div class="msg"><strong>${entry.sender}:</strong> ${entry.message}</div>
              <div class="msg">🌐 언어: ${entry.lang || "N/A"}</div>
            `;
            logsDiv.appendChild(log);
          }
        }
        drawChart(langStats);
      });
    }

    function drawChart(stats) {
      const ctx = document.getElementById("langChart").getContext("2d");
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['English', 'Korean', 'Japanese'],
          datasets: [{
            label: '질문/응답 건수',
            data: [stats.en || 0, stats.ko || 0, stats.ja || 0],
            backgroundColor: ['#4caf50', '#2196f3', '#ff9800']
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }
  </script>

<div style="margin-top: 40px;">
  <h2>🧠 GPT 기반 질문 카테고리 분류</h2>
  <button onclick="categorizeQuestions()" style="padding:10px;background:#333;color:white;border:none;border-radius:6px;">AI로 질문 분류</button>
  <div id="categoryResults" style="margin-top:20px;"></div>
</div>

<script>
async function categorizeQuestions() {
  const logs = document.querySelectorAll(".log .msg strong");
  const messages = Array.from(logs).map(log => log.parentElement.textContent).slice(0, 10).join("\n");

  if (!messages) {
    alert("분석할 질문이 없습니다.");
    return;
  }

  const prompt = `
다음 사용자 질문을 분석하여 각 질문을 아래와 같은 카테고리 중 하나로 분류해 주세요:
[설계, 재배, 물류, 수출입, 문서, 기타]
형식: 질문 → 카테고리

질문 목록:
${messages}
  `;

  document.getElementById("categoryResults").innerText = "AI 분석 중...";

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("categoryResults").innerText = data.choices[0].message.content;
  } catch (e) {
    console.error(e);
    document.getElementById("categoryResults").innerText = "❌ 분석 실패";
  }
}
</script>

<div style="margin-top: 30px;">
  <button onclick="exportCSV()" style="padding:8px 16px;margin-right:10px;">📄 CSV 저장</button>
  <button onclick="exportPDF()" style="padding:8px 16px;">🧾 PDF 저장</button>
</div>

<canvas id="categoryChart" width="400" height="200" style="margin-top:30px;"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
function exportCSV() {
  const content = document.getElementById("categoryResults").innerText;
  const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "category_analysis.csv";
  a.click();
}

function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const content = document.getElementById("categoryResults").innerText;
  const lines = content.split('\n');
  lines.forEach((line, i) => doc.text(line, 10, 10 + i * 10));
  doc.save("category_analysis.pdf");
}

function drawCategoryChartFromText() {
  const text = document.getElementById("categoryResults").innerText;
  const lines = text.split("\n");
  const counts = {
    설계: 0, 재배: 0, 물류: 0, 수출입: 0, 문서: 0, 기타: 0
  };
  lines.forEach(line => {
    for (let key in counts) {
      if (line.includes(key)) counts[key]++;
    }
  });

  const ctx = document.getElementById("categoryChart").getContext("2d");
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: Object.keys(counts),
      datasets: [{
        label: '카테고리별 질문 수',
        data: Object.values(counts),
        backgroundColor: '#198754'
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}
</script>

<script>
const observeCategory = new MutationObserver(drawCategoryChartFromText);
observeCategory.observe(document.getElementById("categoryResults"), { childList: true });
</script>


<div style="margin-top: 40px;">
  <h2>🔎 유사 질문 추천</h2>
  <input type="text" id="similarInput" placeholder="비교할 질문을 입력하세요" style="width:80%;padding:8px;">
  <button onclick="recommendSimilar()" style="padding:8px 16px;">추천 보기</button>
  <div id="similarResults" style="margin-top:15px;font-size:0.9rem;"></div>
</div>

<script>
async function recommendSimilar() {
  const query = document.getElementById("similarInput").value.trim();
  if (!query) return alert("비교할 질문을 입력해 주세요.");

  const allLogs = Array.from(document.querySelectorAll(".log .msg strong"))
    .map(log => log.parentElement.textContent)
    .filter(q => !q.includes("AgriBot"))
    .slice(0, 20).join("\n");

  const prompt = `
아래에 기존 질문들이 있습니다. 이 중에서 입력된 질문과 가장 유사한 질문 3개를 찾아 추천해 주세요.

입력 질문:
"${query}"

기존 질문들:
${allLogs}
`;

  document.getElementById("similarResults").innerText = "🔄 유사 질문 분석 중...";

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("similarResults").innerText = "✅ 추천:
" + data.choices[0].message.content;
  } catch (e) {
    console.error(e);
    document.getElementById("similarResults").innerText = "❌ 추천 실패";
  }
}
</script>


<hr style="margin:40px 0;">

<h2>📂 카테고리 필터링</h2>
<select id="categoryFilter" onchange="filterByCategory()" style="padding:6px;">
  <option value="all">전체</option>
  <option value="설계">설계</option>
  <option value="재배">재배</option>
  <option value="물류">물류</option>
  <option value="수출입">수출입</option>
  <option value="문서">문서</option>
  <option value="기타">기타</option>
</select>

<script>
function filterByCategory() {
  const value = document.getElementById("categoryFilter").value;
  const lines = document.getElementById("categoryResults").innerText.split("\n");
  const filtered = value === "all" ? lines : lines.filter(l => l.includes(value));
  document.getElementById("categoryResults").innerText = filtered.join("\n");
}
</script>

<hr style="margin:40px 0;">

<h2>📆 이용 통계 (기간 필터)</h2>
<select id="periodFilter" onchange="filterStatsByPeriod()" style="padding:6px;">
  <option value="all">전체</option>
  <option value="day">최근 1일</option>
  <option value="week">최근 7일</option>
</select>

<div id="periodStats" style="margin-top:10px;"></div>

<script>
function filterStatsByPeriod() {
  const range = document.getElementById("periodFilter").value;
  const logs = Array.from(document.querySelectorAll(".log .msg")).map(e => ({
    text: e.innerText,
    time: Date.now() // simulate time since Firebase does not show timestamps here
  }));
  let filtered = logs;
  if (range === "day") {
    const limit = Date.now() - 24*60*60*1000;
    filtered = logs.filter(l => l.time > limit);
  } else if (range === "week") {
    const limit = Date.now() - 7*24*60*60*1000;
    filtered = logs.filter(l => l.time > limit);
  }
  document.getElementById("periodStats").innerText = "총 " + filtered.length + "건 분석됨 (임시 시뮬레이션 기준)";
}
</script>

<hr style="margin:40px 0;">

<h2>📈 질문 순위 기반 추천</h2>
<button onclick="showTopQuestions()" style="padding:8px 16px;">상위 질문 보기</button>
<div id="topQuestions" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function showTopQuestions() {
  const questions = Array.from(document.querySelectorAll(".log .msg")).map(e => e.innerText.trim());
  const freq = {};
  questions.forEach(q => {
    if (!q.includes("AgriBot")) {
      freq[q] = (freq[q] || 0) + 1;
    }
  });
  const sorted = Object.entries(freq).sort((a,b) => b[1] - a[1]).slice(0, 5);
  const topText = sorted.map(([q,c], i) => `#${i+1} (${c}회): ${q}`).join("\n");
  document.getElementById("topQuestions").innerText = topText;
}
</script>


<hr style="margin:40px 0;">

<h2>🧪 GPT 분류 정확도 피드백</h2>
<p>아래 버튼을 눌러 GPT 분류 결과에 대한 정확도를 1~5점으로 평가해 주세요.</p>
<div id="feedbackRating">
  <button onclick="submitFeedback(1)">⭐</button>
  <button onclick="submitFeedback(2)">⭐⭐</button>
  <button onclick="submitFeedback(3)">⭐⭐⭐</button>
  <button onclick="submitFeedback(4)">⭐⭐⭐⭐</button>
  <button onclick="submitFeedback(5)">⭐⭐⭐⭐⭐</button>
</div>
<div id="feedbackStatus" style="margin-top:10px;color:green;"></div>

<script>
function submitFeedback(score) {
  const uid = "admin-feedback";
  const time = Date.now();
  const feedback = {
    score,
    timestamp: time
  };
  firebase.database().ref("agrinexus_feedback/" + uid + "/" + time).set(feedback);
  document.getElementById("feedbackStatus").innerText = `감사합니다. (${score}점 제출됨)`;
}
</script>

<hr style="margin:40px 0;">

<h2>🔄 Google Sheets 연동</h2>
<p>분석 결과 또는 질문 로그를 Google Sheets로 내보내고 싶으신가요?</p>
<button onclick="exportToSheets()" style="padding:8px 16px;">📤 시트로 내보내기</button>
<div id="sheetExportStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function exportToSheets() {
  document.getElementById("sheetExportStatus").innerText = "🔄 Google Sheets로 내보내는 중...";
  try {
    // 아래 요청은 실제 연동 시 서버리스 Firebase Functions 또는 AppScript API 필요
    // 여기서는 데모 URL로 대체
    const response = await fetch("https://sheet.googleapis.com/v4/spreadsheets/fake-export-endpoint", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer FAKE_API_KEY"
      },
      body: JSON.stringify({
        values: document.getElementById("categoryResults").innerText.split("\n")
      })
    });
    if (response.ok) {
      document.getElementById("sheetExportStatus").innerText = "✅ Google Sheets로 성공적으로 내보내졌습니다.";
    } else {
      throw new Error("내보내기 실패");
    }
  } catch (e) {
    document.getElementById("sheetExportStatus").innerText = "❌ Google Sheets 연동에 실패했습니다. (API 설정 필요)";
  }
}
</script>


<hr style="margin:40px 0;">
<h2>📊 피드백 점수 통계 시각화</h2>
<button onclick="drawFeedbackChart()" style="padding:8px 16px;">📈 통계 보기</button>
<canvas id="feedbackChart" width="400" height="200" style="margin-top:20px;"></canvas>

<script>
function drawFeedbackChart() {
  firebase.database().ref("agrinexus_feedback/admin-feedback").once("value", snapshot => {
    const data = snapshot.val();
    const scores = [0, 0, 0, 0, 0];
    for (let key in data) {
      const s = data[key].score;
      if (s >= 1 && s <= 5) scores[s - 1]++;
    }
    const ctx = document.getElementById("feedbackChart").getContext("2d");
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['⭐1', '⭐2', '⭐3', '⭐4', '⭐5'],
        datasets: [{
          label: '제출된 피드백 수',
          data: scores,
          backgroundColor: '#ffc107'
        }]
      },
      options: {
        scales: { y: { beginAtZero: true } }
      }
    });
  });
}
</script>

<hr style="margin:40px 0;">
<h2>📤 실연동용 Google Sheets App Script 코드</h2>
<pre style="background:#eee;padding:10px;font-size:0.8rem;overflow-x:auto;">
function doPost(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var data = JSON.parse(e.postData.contents);
  data.values.forEach(row => {
    sheet.appendRow([new Date(), row]);
  });
  return ContentService.createTextOutput("success");
}
</pre>

<p>📝 위 코드를 Google Apps Script에 붙여넣고 웹앱으로 배포하세요.<br>
사용 권한: 누구나 접근 / POST 요청 허용</p>

<hr style="margin:40px 0;">
<h2>🧠 사용자 질문 기반 AI 보정 요청</h2>
<p>GPT가 부정확한 분류를 했다면 아래에 보정 요청을 입력해 주세요.</p>
<textarea id="aiCorrection" rows="3" style="width:100%;padding:8px;"></textarea><br>
<button onclick="submitCorrection()" style="margin-top:10px;padding:8px 16px;">보정 요청 제출</button>
<div id="correctionStatus" style="margin-top:10px;color:green;"></div>

<script>
function submitCorrection() {
  const text = document.getElementById("aiCorrection").value.trim();
  if (!text) return alert("내용을 입력해 주세요.");
  const time = Date.now();
  firebase.database().ref("agrinexus_training").push({
    correction: text,
    timestamp: time
  });
  document.getElementById("correctionStatus").innerText = "✅ 보정 요청이 저장되었습니다.";
  document.getElementById("aiCorrection").value = "";
}
</script>


<hr style="margin:40px 0;">
<h2>📄 수출입 문서 및 계약서 자동화 시스템</h2>
<p>수출입에 필요한 문서 생성, 번역, 진단, 계약서 오류 검토 등 자동화 지원.</p>
<button onclick="startAutoDocumentSystem()" style="padding:10px 20px;">🚀 자동 문서 분석 실행</button>
<div id="docAutomationResults" style="margin-top:15px;font-size:0.9rem;"></div>

<script>
async function startAutoDocumentSystem() {
  const prompt = `
다음과 같은 기능을 자동화합니다:
1. 수출입 문서/계약서에 대한 자동 생성 및 국가별 언어 번역
2. 법률적 표현과 항목의 누락 여부 자동 진단
3. 잘못된 작성 예시 감지 및 추천 수정안 제시
4. 사용자 질문에 기반한 CS 대응 자동화

예시 문서:
- 수출계약서, 송장, 세관신고서 등
- 작성 오류 예: 서명 누락, 날짜 오류, 문장 불일치

위 기능을 기반으로 스마트 문서 시스템 보고서를 생성하세요. 각 항목은 상세하게 기술해 주세요.
  `;

  document.getElementById("docAutomationResults").innerText = "📄 자동화 보고서 생성 중...";

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("docAutomationResults").innerText = "✅ 자동화 분석 결과:
" + data.choices[0].message.content;
  } catch (e) {
    console.error(e);
    document.getElementById("docAutomationResults").innerText = "❌ 자동 분석 실패. 다시 시도해 주세요.";
  }
}
</script>


<hr style="margin:40px 0;">
<h2>🌍 국가별 수출입 문서 자동 안내 시스템</h2>
<p>수출입하려는 국가를 선택하면 필요한 필수 문서와 준비사항을 실시간 안내합니다.</p>

<select id="countrySelector" style="padding:8px;">
  <option value="United States">🇺🇸 미국</option>
  <option value="Korea">🇰🇷 대한민국</option>
  <option value="Japan">🇯🇵 일본</option>
  <option value="Germany">🇩🇪 독일</option>
  <option value="China">🇨🇳 중국</option>
</select>

<input type="text" id="productInfo" placeholder="제품 또는 서비스 입력" style="padding:8px;width:300px;" />
<button onclick="fetchCountryDocs()" style="padding:8px 16px;">📄 문서 확인</button>

<div id="countryDocResults" style="margin-top:20px;font-size:0.9rem;"></div>

<script>
async function fetchCountryDocs() {
  const country = document.getElementById("countrySelector").value;
  const product = document.getElementById("productInfo").value.trim();
  if (!product) return alert("제품 또는 서비스를 입력해 주세요.");

  document.getElementById("countryDocResults").innerText = "📦 문서 정보 로딩 중...";

  const prompt = `
"${country}"로 "${product}"를 수출/수입하려는 경우,
필수로 준비해야 할 서류, 통관 문서, 계약서 항목, 주의사항, 제도 차이 등을 다음 항목에 따라 안내해 주세요:

1. 필수 수출입 문서
2. 계약서 필수 항목
3. 통관 및 세관 요건
4. 국가별 언어 번역 필요 여부
5. 일반적으로 발생하는 오류 및 사전 준비 체크리스트
  `;

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("countryDocResults").innerText = data.choices[0].message.content;
  } catch (e) {
    console.error(e);
    document.getElementById("countryDocResults").innerText = "❌ 국가별 문서 정보 조회 실패";
  }
}
</script>


<hr style="margin:40px 0;">
<h2>📝 계약서 자동 완성 시스템</h2>
<p>제품 또는 서비스와 국가를 입력하면 자동으로 맞춤형 계약서 템플릿을 생성합니다.</p>

<input type="text" id="contractProduct" placeholder="제품 또는 서비스 입력" style="padding:8px;width:300px;" />
<select id="contractCountry" style="padding:8px;">
  <option value="United States">🇺🇸 미국</option>
  <option value="Korea">🇰🇷 한국</option>
  <option value="Japan">🇯🇵 일본</option>
  <option value="Germany">🇩🇪 독일</option>
  <option value="China">🇨🇳 중국</option>
</select>
<button onclick="generateContract()" style="padding:8px 16px;">📄 계약서 생성</button>

<div id="contractResult" style="margin-top:20px;font-size:0.9rem;"></div>

<script>
async function generateContract() {
  const product = document.getElementById("contractProduct").value.trim();
  const country = document.getElementById("contractCountry").value;

  if (!product) return alert("제품 또는 서비스를 입력해 주세요.");

  document.getElementById("contractResult").innerText = "📄 계약서 생성 중...";

  const prompt = `
"${country}" 국가에 "${product}"를 수출입하기 위한 국제 표준 계약서를 자동으로 작성해 주세요.
계약서는 다음 항목을 포함해야 합니다:
- 거래 당사자 정보
- 품목명, 수량, 가격 조건
- 지불 조건 및 일정
- 인코텀즈 조건 (예: FOB, CIF)
- 통관 및 보험 책임
- 서명란
내용은 공식적이고 법적 효력이 있도록 구성해 주세요.
  `;

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("contractResult").innerText = data.choices[0].message.content;
  } catch (e) {
    console.error(e);
    document.getElementById("contractResult").innerText = "❌ 계약서 생성 실패";
  }
}
</script>

<hr style="margin:40px 0;">
<h2>📦 HS 코드 (세관 코드) 추천 시스템</h2>
<p>제품을 입력하면 수출입 시 필요한 관세분류코드(HS Code)를 자동 추천합니다.</p>

<input type="text" id="hsProduct" placeholder="제품 입력 (예: LED 조명, 토마토 등)" style="padding:8px;width:300px;" />
<button onclick="recommendHSCode()" style="padding:8px 16px;">📌 코드 추천</button>

<div id="hsCodeResult" style="margin-top:20px;font-size:0.9rem;"></div>

<script>
async function recommendHSCode() {
  const product = document.getElementById("hsProduct").value.trim();
  if (!product) return alert("제품을 입력해 주세요.");

  document.getElementById("hsCodeResult").innerText = "🔍 HS 코드 조회 중...";

  const prompt = `
"${product}"에 해당하는 최신 국제 통일 관세분류코드(HS Code)를 알려 주세요.
가능한 경우 6자리 코드 기준으로 제공해 주세요.
예: 0702.00 - 토마토(신선 또는 냉장)
  `;

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("hsCodeResult").innerText = data.choices[0].message.content;
  } catch (e) {
    console.error(e);
    document.getElementById("hsCodeResult").innerText = "❌ HS 코드 조회 실패";
  }
}
</script>


<hr style="margin:40px 0;">
<h2>📤 계약서 PDF 다운로드 및 이메일 전송</h2>
<p>계약서가 생성되면 아래 버튼으로 PDF 다운로드 또는 이메일 전송이 가능합니다.</p>
<button onclick="downloadContractPDF()" style="padding:8px 16px;">🧾 PDF 다운로드</button>
<button onclick="emailContract()" style="padding:8px 16px;">📬 이메일 전송</button>
<div id="emailStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
function downloadContractPDF() {
  const content = document.getElementById("contractResult").innerText;
  if (!content) return alert("먼저 계약서를 생성해 주세요.");
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const lines = content.split('\n');
  lines.forEach((line, i) => doc.text(line, 10, 10 + i * 10));
  doc.save("AgriNexus_Contract.pdf");
}

function emailContract() {
  const content = document.getElementById("contractResult").innerText;
  if (!content) return alert("먼저 계약서를 생성해 주세요.");

  // Simulated email function (replace with real backend or email API)
  document.getElementById("emailStatus").innerText = "📧 이메일 전송 중...";
  setTimeout(() => {
    document.getElementById("emailStatus").innerText = "✅ 이메일이 성공적으로 전송되었습니다! (시뮬레이션)";
  }, 1500);
}
</script>


<hr style="margin:40px 0;">
<h2>✈️🚢📦 전세계 항공/선박/카고/택배 실시간 배송 정보 시스템</h2>
<p>국가와 운송 유형을 선택하면 실시간 배송 및 물류 정보를 제공합니다.</p>

<select id="logisticsCountry" style="padding:8px;">
  <option value="United States">🇺🇸 미국</option>
  <option value="Korea">🇰🇷 한국</option>
  <option value="Japan">🇯🇵 일본</option>
  <option value="Germany">🇩🇪 독일</option>
  <option value="China">🇨🇳 중국</option>
</select>

<select id="logisticsType" style="padding:8px;">
  <option value="air">✈️ 항공</option>
  <option value="sea">🚢 선박</option>
  <option value="cargo">📦 카고</option>
  <option value="courier">📮 택배</option>
</select>

<button onclick="fetchLogisticsInfo()" style="padding:8px 16px;">🔍 배송 정보 조회</button>
<div id="logisticsResult" style="margin-top:20px;font-size:0.9rem;"></div>

<script>
async function fetchLogisticsInfo() {
  const country = document.getElementById("logisticsCountry").value;
  const type = document.getElementById("logisticsType").value;
  document.getElementById("logisticsResult").innerText = "🚚 물류 정보 로딩 중...";

  const prompt = `
"${country}" 국가의 "${type}" 운송 방식에 대해 다음 정보를 실시간으로 제공해 주세요:

1. 최근 출발 및 도착 정보 (예시 기반)
2. 예상 배송 소요 시간
3. 주요 허브 및 항만/공항
4. 특이사항 또는 지연 요소
5. 물류 운영 업체 예시 (DHL, FedEx, Maersk 등)

각 항목은 명확하고 간결하게 요약해 주세요.
  `;

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("logisticsResult").innerText = data.choices[0].message.content;
  } catch (e) {
    document.getElementById("logisticsResult").innerText = "❌ 실시간 물류 조회 실패";
  }
}
</script>


<hr style="margin:40px 0;">
<h2>💰 실시간 운송비 비교 분석 + 최적 선택 추천 시스템</h2>
<p>국가 및 운송 유형, 예상 무게/부피 입력 시 최적의 물류 선택을 자동 추천합니다.</p>

<select id="costCountry" style="padding:8px;">
  <option value="United States">🇺🇸 미국</option>
  <option value="Korea">🇰🇷 한국</option>
  <option value="Japan">🇯🇵 일본</option>
  <option value="Germany">🇩🇪 독일</option>
  <option value="China">🇨🇳 중국</option>
</select>

<select id="costType" style="padding:8px;">
  <option value="air">✈️ 항공</option>
  <option value="sea">🚢 선박</option>
  <option value="cargo">📦 카고</option>
  <option value="courier">📮 택배</option>
</select>

<input type="text" id="costWeight" placeholder="예상 무게 (kg)" style="padding:8px;width:140px;" />
<input type="text" id="costVolume" placeholder="예상 부피 (CBM)" style="padding:8px;width:140px;" />

<button onclick="fetchLogisticsCost()" style="padding:8px 16px;">📊 비용 분석</button>

<div id="logisticsCostResult" style="margin-top:20px;font-size:0.9rem;"></div>

<script>
async function fetchLogisticsCost() {
  const country = document.getElementById("costCountry").value;
  const type = document.getElementById("costType").value;
  const weight = document.getElementById("costWeight").value.trim();
  const volume = document.getElementById("costVolume").value.trim();

  if (!weight || !volume) return alert("무게와 부피를 입력해 주세요.");

  document.getElementById("logisticsCostResult").innerText = "💸 비용 분석 중...";

  const prompt = `
"${country}"로 "${type}" 방식의 운송을 진행할 때, 무게 ${weight}kg, 부피 ${volume}CBM 기준으로 
다음 항목을 비교 분석해 주세요:

1. 추천 운송사별 가격 예시 (DHL, FedEx, Maersk, 우체국 등)
2. 항공 vs 선박 vs 카고 vs 택배 요금 비교
3. 배송 시간 및 보험 포함 여부
4. 추천 최적 운송 방식 및 이유
5. 이용자에게 가장 효율적인 선택 안내

최종 선택 가이드를 마지막에 요약해 주세요.
  `;

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("logisticsCostResult").innerText = data.choices[0].message.content;
  } catch (e) {
    console.error(e);
    document.getElementById("logisticsCostResult").innerText = "❌ 운송비 분석 실패";
  }
}
</script>


<hr style="margin:40px 0;">
<h2>🚚 고급 화물 조건 기반 물류비 최적 분석 시스템</h2>
<p>화물의 재질, 성격, 무게, 부피, 유통 조건에 따라 최적의 물류 선택을 자동 분석합니다.</p>

<select id="cargoMaterial" style="padding:8px;">
  <option value="steel">강철</option>
  <option value="plastic">플라스틱</option>
  <option value="wood">목재</option>
  <option value="liquid">액체</option>
  <option value="perishable">신선/부패성</option>
</select>

<select id="cargoNature" style="padding:8px;">
  <option value="hazardous">위험물</option>
  <option value="fragile">깨지기 쉬움</option>
  <option value="general">일반품</option>
  <option value="refrigerated">냉장/냉동</option>
</select>

<input type="text" id="cargoWeight" placeholder="무게 (kg)" style="padding:8px;width:140px;" />
<input type="text" id="cargoVolume" placeholder="부피 (CBM)" style="padding:8px;width:140px;" />
<input type="text" id="cargoDuration" placeholder="희망 운송기간 (일)" style="padding:8px;width:180px;" />

<button onclick="analyzeAdvancedLogistics()" style="padding:8px 16px;">🔍 고급 분석 실행</button>

<div id="advancedLogisticsResult" style="margin-top:20px;font-size:0.9rem;"></div>

<script>
async function analyzeAdvancedLogistics() {
  const material = document.getElementById("cargoMaterial").value;
  const nature = document.getElementById("cargoNature").value;
  const weight = document.getElementById("cargoWeight").value.trim();
  const volume = document.getElementById("cargoVolume").value.trim();
  const duration = document.getElementById("cargoDuration").value.trim();

  if (!weight || !volume || !duration) return alert("모든 항목을 입력해 주세요.");

  document.getElementById("advancedLogisticsResult").innerText = "🚛 고급 물류 분석 중...";

  const prompt = `
화물 정보:
- 재질: ${material}
- 성격: ${nature}
- 무게: ${weight}kg
- 부피: ${volume}CBM
- 희망 운송 기간: ${duration}일

위 정보를 기반으로 최적의 물류 운송 방법(항공, 선박, 카고, 컨테이너 등)을 선택하고,
1. 예상 운송비
2. 추천 운송사
3. 유통 조건
4. 장단점
5. 위험 요소
6. 최종 추천 옵션

을 실시간 분석하여 안내해 주세요.
  `;

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("advancedLogisticsResult").innerText = data.choices[0].message.content;
  } catch (e) {
    document.getElementById("advancedLogisticsResult").innerText = "❌ 분석 실패";
  }
}
</script>


<hr style="margin:40px 0;">
<h2>📄 실 견적서 자동 생성 및 전송 시스템</h2>
<p>자동 분석된 물류 정보를 바탕으로 견적서를 PDF로 생성하고 이메일 전송합니다.</p>
<input type="email" id="estimateEmail" placeholder="받는 이메일 주소" style="padding:8px;width:300px;" />
<button onclick="generateEstimatePDF()" style="padding:8px 16px;">🧾 견적서 PDF 생성</button>
<button onclick="sendEstimateEmail()" style="padding:8px 16px;">📬 견적서 이메일 전송</button>
<div id="estimateStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
function generateEstimatePDF() {
  const content = document.getElementById("advancedLogisticsResult").innerText;
  if (!content) return alert("먼저 분석을 실행해 주세요.");
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const lines = content.split('\n');
  lines.forEach((line, i) => doc.text(line, 10, 10 + i * 10));
  doc.save("AgriNexus_Estimate.pdf");
  document.getElementById("estimateStatus").innerText = "✅ PDF 생성 완료!";
}

function sendEstimateEmail() {
  const email = document.getElementById("estimateEmail").value.trim();
  if (!email) return alert("이메일을 입력해 주세요.");
  document.getElementById("estimateStatus").innerText = "📬 이메일 전송 중... (시뮬레이션)";
  setTimeout(() => {
    document.getElementById("estimateStatus").innerText = "✅ 이메일 전송 완료! (시뮬레이션)";
  }, 1500);
}
</script>

<hr style="margin:40px 0;">
<h2>📦 컨테이너 단가 자동 비교</h2>
<p>일반/냉장/20ft/40ft 컨테이너 운송 비용 비교 분석</p>
<button onclick="compareContainerRates()" style="padding:8px 16px;">📊 단가 비교 실행</button>
<div id="containerRateResult" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function compareContainerRates() {
  document.getElementById("containerRateResult").innerText = "📦 컨테이너 단가 분석 중...";
  const prompt = `
20ft, 40ft, 냉장, 특수 컨테이너 운송 시 평균 단가 비교 분석 보고서를 작성해 주세요.
- 항공 vs 해상 비교 포함
- 수출입 국가에 따라 가격 차이 예시도 포함
- 적합한 용도와 상황별 추천도 제시
  `;
  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });
  const data = await res.json();
  document.getElementById("containerRateResult").innerText = data.choices[0].message.content;
}
</script>

<hr style="margin:40px 0;">
<h2>🛡️ 보험 조건 자동 제안</h2>
<button onclick="suggestInsuranceTerms()" style="padding:8px 16px;">🧾 보험 분석 실행</button>
<div id="insuranceSuggestion" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function suggestInsuranceTerms() {
  document.getElementById("insuranceSuggestion").innerText = "🛡️ 보험 조건 분석 중...";
  const prompt = `
국제물류에 필요한 보험 항목을 분석하고, 일반화물, 고가품, 냉동품, 위험물 등 조건별 적절한 보험 범위와
추천 보험사를 제안해 주세요.
  `;
  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });
  const data = await res.json();
  document.getElementById("insuranceSuggestion").innerText = data.choices[0].message.content;
}
</script>

<hr style="margin:40px 0;">
<h2>🌐 국가별 물류 이슈 실시간 반영</h2>
<button onclick="fetchLogisticsIssues()" style="padding:8px 16px;">🌍 이슈 조회</button>
<div id="logisticsIssues" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function fetchLogisticsIssues() {
  document.getElementById("logisticsIssues").innerText = "🌐 전세계 물류 이슈 조회 중...";
  const prompt = `
전세계 주요 국가의 현재 물류 지연, 항만 정체, 항공 운항 중단, 통관 이슈 등을 정리해 주세요.
특히 한국, 미국, 유럽, 중국, 일본 위주로 최신 문제를 정리해 주세요.
  `;
  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });
  const data = await res.json();
  document.getElementById("logisticsIssues").innerText = data.choices[0].message.content;
}
</script>


<hr style="margin:40px 0;">
<h2>📦 1인 사업자 / 소규모 수출입 지원 시스템</h2>
<p>단 1개의 상품이라도 쉽게 수출입할 수 있도록 자동 추천 및 물류 최적화 안내를 제공합니다.</p>

<input type="text" id="smeProduct" placeholder="상품명 (예: 휴대용 선풍기)" style="padding:8px;width:300px;" />
<input type="text" id="smeQty" placeholder="수량 (예: 10개)" style="padding:8px;width:150px;" />
<select id="smeTarget" style="padding:8px;">
  <option value="United States">🇺🇸 미국</option>
  <option value="Korea">🇰🇷 한국</option>
  <option value="Japan">🇯🇵 일본</option>
  <option value="Germany">🇩🇪 독일</option>
  <option value="China">🇨🇳 중국</option>
</select>

<button onclick="analyzeSMELogistics()" style="padding:8px 16px;">🔍 소규모 물류 분석</button>

<div id="smeLogisticsResult" style="margin-top:20px;font-size:0.9rem;"></div>

<script>
async function analyzeSMELogistics() {
  const product = document.getElementById("smeProduct").value.trim();
  const qty = document.getElementById("smeQty").value.trim();
  const country = document.getElementById("smeTarget").value;

  if (!product || !qty) return alert("상품명과 수량을 입력해 주세요.");

  document.getElementById("smeLogisticsResult").innerText = "📦 소규모 물류 분석 중...";

  const prompt = `
"${product}"를 ${qty}개 수출입하고자 하는 개인 또는 소규모 사업자가 "${country}"를 대상으로 할 때, 
1. 적절한 운송 방식 (항공, 택배, EMS 등)
2. 예상 운송비
3. 포장/통관 주의사항
4. 수량이 적은 경우 유리한 조건
5. 적합한 물류 회사 추천
6. 자동화된 추천 가이드

위 내용을 자동으로 분석하여 안내해 주세요.
  `;

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("smeLogisticsResult").innerText = data.choices[0].message.content;
  } catch (e) {
    document.getElementById("smeLogisticsResult").innerText = "❌ 분석 실패";
  }
}
</script>


<hr style="margin:40px 0;">
<h2>📚 수출입 문서 용어 해석 + 법률 해결 자동 시스템</h2>
<p>수출입 계약서, 통관 문서 등에서 어려운 물류 용어와 각국 법률 사안을 자동으로 해석하고 해결 가이드를 제시합니다.</p>

<textarea id="documentText" placeholder="문서 내용을 붙여넣으세요 (예: 계약서 조항, 통관 문장 등)" style="width:100%;height:100px;padding:10px;"></textarea>
<button onclick="explainDocumentTerms()" style="padding:10px 20px;">🧠 문서 해석 및 해결안 생성</button>

<div id="documentExplainResult" style="margin-top:20px;font-size:0.9rem;"></div>

<script>
async function explainDocumentTerms() {
  const doc = document.getElementById("documentText").value.trim();
  if (!doc) return alert("문서 내용을 입력해 주세요.");
  document.getElementById("documentExplainResult").innerText = "📘 용어 해석 및 해결 방법 분석 중...";

  const prompt = `
다음 문서 또는 계약서 조항 내용을 기반으로,
1. 전문 용어를 알기 쉽게 해석하고
2. 포함된 수출입 법률적 요소를 한국과 주요 국가 기준으로 설명하고
3. 자주 발생하는 문제 및 분쟁을 예방할 수 있는 해결 방법을 제안해 주세요.
4. 초보자도 쉽게 이해할 수 있도록 쉬운 표현으로 작성해 주세요.

문서 내용:
${doc}
  `;

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    document.getElementById("documentExplainResult").innerText = data.choices[0].message.content;
  } catch (e) {
    document.getElementById("documentExplainResult").innerText = "❌ 해석 실패";
  }
}
</script>


<hr style="margin:40px 0;">
<h2>📄 문서 자동 요약 및 PDF 보고서 생성</h2>
<button onclick="summarizeAndExportPDF()" style="padding:8px 16px;">🧾 요약 + PDF 생성</button>
<div id="summaryPDFStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function summarizeAndExportPDF() {
  const doc = document.getElementById("documentText").value.trim();
  if (!doc) return alert("문서 내용을 먼저 입력해 주세요.");
  document.getElementById("summaryPDFStatus").innerText = "📄 요약 및 PDF 생성 중...";

  const prompt = `
다음 문서를 요약하고 핵심 내용을 정리하여 PDF 보고서 형태로 정리해 주세요:
${doc}
  `;

  try {
    const res = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer sk-abc123xyz456def..."
      },
      body: JSON.stringify({
        model: "gpt-3.5-turbo",
        messages: [{ role: "user", content: prompt }]
      })
    });

    const data = await res.json();
    const summary = data.choices[0].message.content;

    const { jsPDF } = window.jspdf;
    const docPDF = new jsPDF();
    const lines = summary.split("\n");
    lines.forEach((line, i) => docPDF.text(line, 10, 10 + i * 10));
    docPDF.save("AgriNexus_Report_Summary.pdf");

    document.getElementById("summaryPDFStatus").innerText = "✅ PDF 생성 완료!";
  } catch (e) {
    console.error(e);
    document.getElementById("summaryPDFStatus").innerText = "❌ PDF 생성 실패";
  }
}
</script>

<hr style="margin:40px 0;">
<h2>🌐 국가별 수출입 법령 변화 실시간 감지</h2>
<button onclick="checkLegalChanges()" style="padding:8px 16px;">🧠 최신 법령 분석</button>
<div id="legalChangeResult" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function checkLegalChanges() {
  document.getElementById("legalChangeResult").innerText = "🔍 최신 법률 정보 분석 중...";
  const prompt = `
한국, 미국, EU, 중국, 일본의 최근 수출입 법령 및 통관 제도 변경사항을 요약 정리해 주세요.
특히 중소기업, 스타트업, 신생 사업자에게 영향이 있는 내용을 강조해 주세요.
  `;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
      },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });

  const data = await res.json();
  document.getElementById("legalChangeResult").innerText = data.choices[0].message.content;
}
</script>

<hr style="margin:40px 0;">
<h2>⚖️ 수출입 분쟁 대응 시뮬레이터</h2>
<textarea id="disputeInput" placeholder="분쟁 상황 또는 조항 입력 (예: 운송 지연 관련 조항)" style="width:100%;height:80px;padding:8px;"></textarea>
<button onclick="simulateDisputeResolution()" style="padding:8px 16px;">🤖 대응 시뮬레이션 실행</button>
<div id="disputeResult" style="margin-top:20px;font-size:0.9rem;"></div>

<script>
async function simulateDisputeResolution() {
  const scenario = document.getElementById("disputeInput").value.trim();
  if (!scenario) return alert("분쟁 상황을 입력해 주세요.");
  document.getElementById("disputeResult").innerText = "🧠 분쟁 해결 시뮬레이션 중...";

  const prompt = `
다음 분쟁 또는 계약 조항에 대해 현실적인 대응 전략을 제안해 주세요.
국제무역 분쟁 전문가 입장에서,
- 관련 법령
- 피해 최소화 전략
- 법률적 절차
- 중재/소송 여부
- 소기업 또는 개인이 선택 가능한 최적 대응안을 포함해 주세요.

내용:
${scenario}
  `;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
      },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });

  const data = await res.json();
  document.getElementById("disputeResult").innerText = data.choices[0].message.content;
}
</script>


<hr style="margin:40px 0;">
<h2>🧠 사용자 맞춤형 대응 시스템 (CRM 응답 저장)</h2>
<input type="text" id="crmUser" placeholder="사용자 이메일 또는 이름" style="padding:8px;width:300px;" />
<textarea id="crmFeedback" placeholder="사용자의 문의 또는 응답 내용" style="width:100%;height:80px;padding:8px;"></textarea>
<button onclick="saveCRMResponse()" style="padding:8px 16px;">💾 CRM 응답 저장</button>
<div id="crmStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function saveCRMResponse() {
  const user = document.getElementById("crmUser").value.trim();
  const msg = document.getElementById("crmFeedback").value.trim();
  if (!user || !msg) return alert("사용자 정보와 메시지를 입력해 주세요.");
  const entry = { user, msg, time: new Date().toISOString() };
  const data = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  data.push(entry);
  localStorage.setItem("agrinexus_crm", JSON.stringify(data));
  document.getElementById("crmStatus").innerText = "✅ CRM 응답 저장 완료!";
  document.getElementById("crmUser").value = "";
  document.getElementById("crmFeedback").value = "";
}
</script>

<hr style="margin:40px 0;">
<h2>🗂️ 리포트 자동 축적 + 월간 요약</h2>
<button onclick="showMonthlyReport()" style="padding:8px 16px;">📆 월간 요약 보기</button>
<div id="monthlyReport" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function showMonthlyReport() {
  const data = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  const now = new Date();
  const month = now.getMonth();
  const filtered = data.filter(entry => new Date(entry.time).getMonth() === month);
  const users = [...new Set(filtered.map(e => e.user))];
  const report = `📆 ${now.getFullYear()}년 ${month + 1}월 기준 CRM 응답 수: ${filtered.length}\n사용자 수: ${users.length}\n`;
  document.getElementById("monthlyReport").innerText = report;
}
</script>

<hr style="margin:40px 0;">
<h2>📬 보고서 자동 이메일 전송 (시뮬레이션)</h2>
<input type="email" id="reportEmail" placeholder="받는 이메일 주소" style="padding:8px;width:300px;" />
<button onclick="sendMonthlyReport()" style="padding:8px 16px;">📤 이메일 전송</button>
<div id="emailReportStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function sendMonthlyReport() {
  const email = document.getElementById("reportEmail").value.trim();
  if (!email) return alert("이메일 주소를 입력해 주세요.");
  document.getElementById("emailReportStatus").innerText = "📤 보고서 전송 중...";
  setTimeout(() => {
    document.getElementById("emailReportStatus").innerText = `✅ ${email} 으로 보고서 전송 완료! (시뮬레이션)`;
  }, 1500);
}
</script>


<hr style="margin:40px 0;">
<h2>📊 사용자 응답 통계 대시보드</h2>
<button onclick="renderCRMChart()" style="padding:8px 16px;">📈 통계 차트 보기</button>
<canvas id="crmChart" width="400" height="200" style="margin-top:20px;"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
function renderCRMChart() {
  const rawData = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  const dateMap = {};
  rawData.forEach(entry => {
    const d = new Date(entry.time);
    const label = `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,'0')}`;
    dateMap[label] = (dateMap[label] || 0) + 1;
  });

  const labels = Object.keys(dateMap).sort();
  const values = labels.map(label => dateMap[label]);

  const ctx = document.getElementById('crmChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: '월별 CRM 응답 수',
        data: values,
        backgroundColor: '#4CAF50'
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}
</script>


<hr style="margin:40px 0;">
<h2>📁 통계 차트 PDF 저장</h2>
<button onclick="downloadChartAsPDF()" style="padding:8px 16px;">🧾 PDF로 저장</button>
<div id="chartPDFStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function downloadChartAsPDF() {
  const canvas = document.getElementById("crmChart");
  const imageData = canvas.toDataURL("image/png");
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  pdf.addImage(imageData, 'PNG', 10, 10, 180, 100);
  pdf.save("AgriNexus_CRM_Chart.pdf");
  document.getElementById("chartPDFStatus").innerText = "✅ PDF 저장 완료";
}
</script>

<hr style="margin:40px 0;">
<h2>🔐 사용자별 CRM 응답 열람</h2>
<button onclick="showUserResponses()" style="padding:8px 16px;">📋 사용자별 보기</button>
<div id="userResponses" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function showUserResponses() {
  const data = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  const map = {};
  data.forEach(e => {
    if (!map[e.user]) map[e.user] = [];
    map[e.user].push(e.msg);
  });
  let output = "";
  Object.keys(map).forEach(user => {
    output += `📧 ${user}\n`;
    map[user].forEach(msg => output += ` - ${msg}\n`);
  });
  document.getElementById("userResponses").innerText = output || "⚠️ 저장된 응답이 없습니다.";
}
</script>

<hr style="margin:40px 0;">
<h2>📊 일간/주간/월간 비교 분석</h2>
<select id="timeFilter" onchange="filterByTimeRange()" style="padding:6px;">
  <option value="day">최근 1일</option>
  <option value="week">최근 7일</option>
  <option value="month">최근 30일</option>
</select>
<div id="timeRangeStats" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function filterByTimeRange() {
  const range = document.getElementById("timeFilter").value;
  const data = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  const now = Date.now();
  let cutoff = now;
  if (range === "day") cutoff -= 1 * 24 * 60 * 60 * 1000;
  if (range === "week") cutoff -= 7 * 24 * 60 * 60 * 1000;
  if (range === "month") cutoff -= 30 * 24 * 60 * 60 * 1000;

  const filtered = data.filter(e => new Date(e.time).getTime() > cutoff);
  document.getElementById("timeRangeStats").innerText = `📆 ${range.toUpperCase()} 기준 응답 수: ${filtered.length}`;
}
</script>


<hr style="margin:40px 0;">
<h2>📂 CRM 응답 CSV 내보내기</h2>
<button onclick="exportCRMtoCSV()" style="padding:8px 16px;">📤 CSV 다운로드</button>
<div id="csvStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function exportCRMtoCSV() {
  const data = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  if (!data.length) return alert("저장된 응답이 없습니다.");
  const header = "User,Message,Time\n";
  const rows = data.map(d => `"${d.user}","${d.msg}","${d.time}"`).join("\n");
  const blob = new Blob([header + rows], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "agrinexus_crm_responses.csv";
  link.click();
  document.getElementById("csvStatus").innerText = "✅ CSV 파일 다운로드 완료";
}
</script>

<hr style="margin:40px 0;">
<h2>📈 응답 유형별 태그 및 감성 분석</h2>
<button onclick="analyzeSentiments()" style="padding:8px 16px;">🔍 감성 분석 실행</button>
<div id="sentimentResults" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function analyzeSentiments() {
  const data = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  const input = data.slice(-10).map(d => `- ${d.msg}`).join("\n");

  if (!input) return alert("분석할 응답이 없습니다.");

  document.getElementById("sentimentResults").innerText = "🧠 감성 및 태그 분석 중...";

  const prompt = `
다음 고객 응답 메시지 10개를 분석하여 아래 기준으로 태깅해 주세요:
- 주요 키워드 추출
- 감성 분석 (긍정/중립/부정)
- 응답 유형 (문의, 불만, 칭찬, 제안 등)
형식: 메시지 → 키워드 / 감성 / 유형

${input}
  `;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });

  const dataOut = await res.json();
  document.getElementById("sentimentResults").innerText = dataOut.choices[0].message.content;
}
</script>

<hr style="margin:40px 0;">
<h2>🤖 GPT 기반 피드백 자동 응답 생성</h2>
<textarea id="autoReplyInput" placeholder="고객 응답을 입력해 주세요" style="width:100%;height:80px;padding:8px;"></textarea>
<button onclick="generateAutoReply()" style="padding:8px 16px;">✉️ 자동 응답 생성</button>
<div id="autoReplyResult" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function generateAutoReply() {
  const input = document.getElementById("autoReplyInput").value.trim();
  if (!input) return alert("입력 내용을 작성해 주세요.");
  document.getElementById("autoReplyResult").innerText = "📩 자동 응답 생성 중...";

  const prompt = `
다음 고객 메시지에 대해 감사의 말과 함께 정확하고 친절한 답변을 작성해 주세요. 200자 이내:

"${input}"
  `;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });

  const dataOut = await res.json();
  document.getElementById("autoReplyResult").innerText = dataOut.choices[0].message.content;
}
</script>


<hr style="margin:40px 0;">
<h2>📬 자동 응답 이메일 전송 (시뮬레이션)</h2>
<input type="email" id="replyEmail" placeholder="고객 이메일" style="padding:8px;width:300px;" />
<button onclick="simulateReplySend()" style="padding:8px 16px;">📤 자동 응답 메일 전송</button>
<div id="emailReplyStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function simulateReplySend() {
  const email = document.getElementById("replyEmail").value.trim();
  if (!email) return alert("이메일 주소를 입력해 주세요.");
  document.getElementById("emailReplyStatus").innerText = "📡 메일 전송 중...";
  setTimeout(() => {
    document.getElementById("emailReplyStatus").innerText = `✅ ${email} 으로 응답 전송 완료! (시뮬레이션)`;
  }, 1200);
}
</script>

<hr style="margin:40px 0;">
<h2>📈 감성 변화 추적 차트</h2>
<canvas id="sentimentTrendChart" width="400" height="200" style="margin-top:10px;"></canvas>
<button onclick="drawSentimentTrend()" style="padding:8px 16px;">📊 감성 변화 보기</button>

<script>
function drawSentimentTrend() {
  const rawData = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  const sample = rawData.slice(-12).map(d => d.msg);

  const sentimentValues = sample.map(msg => {
    if (msg.includes("감사") || msg.includes("좋아요")) return 2;
    if (msg.includes("불편") || msg.includes("늦음") || msg.includes("불만")) return 0;
    return 1;
  });

  const ctx = document.getElementById("sentimentTrendChart").getContext("2d");
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: sentimentValues.map((_, i) => `응답${i+1}`),
      datasets: [{
        label: '감성 추이 (0:부정, 1:중립, 2:긍정)',
        data: sentimentValues,
        borderColor: '#2196F3',
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { min: 0, max: 2, ticks: { stepSize: 1 } }
      }
    }
  });
}
</script>

<hr style="margin:40px 0;">
<h2>🔍 유사 피드백 클러스터링 (GPT 기반)</h2>
<button onclick="clusterSimilarFeedback()" style="padding:8px 16px;">🧠 클러스터 분석 실행</button>
<div id="feedbackClusters" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function clusterSimilarFeedback() {
  const data = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  const messages = data.slice(-12).map(d => `- ${d.msg}`).join("\n");
  if (!messages) return alert("분석할 응답이 없습니다.");
  document.getElementById("feedbackClusters").innerText = "🔎 클러스터 분석 중...";

  const prompt = `
다음 고객 피드백들을 유사한 유형끼리 3~5개의 클러스터로 묶어주세요.
각 그룹은 공통 주제 또는 감정이 있어야 하며, 대표 키워드와 함께 묶어주세요:

${messages}
  `;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });

  const result = await res.json();
  document.getElementById("feedbackClusters").innerText = result.choices[0].message.content;
}
</script>


<hr style="margin:40px 0;">
<h2>📤 SendGrid 이메일 전송 통합 (실제 API 연동용)</h2>
<p>실제 SendGrid 연동을 위해 API 키를 설정하고 아래 코드를 백엔드에 연동해 주세요:</p>
<pre style="background:#f0f0f0;padding:10px;font-size:0.8rem;overflow-x:auto;">
POST https://api.sendgrid.com/v3/mail/send
Headers:
  Authorization: Bearer YOUR_API_KEY
  Content-Type: application/json

Body:
{
  "personalizations": [{ "to": [{ "email": "client@example.com" }] }],
  "from": { "email": "noreply@agrinexus.world" },
  "subject": "AgriNexus 자동 응답",
  "content": [{ "type": "text/plain", "value": "자동 응답 내용입니다." }]
}
</pre>

---

<h2>🔁 자동 응답 생성 + 이메일 전송 통합 워크플로우</h2>
<textarea id="workflowInput" placeholder="고객 피드백 입력" style="width:100%;height:80px;padding:8px;"></textarea>
<input type="email" id="workflowEmail" placeholder="받는 이메일 주소" style="padding:8px;width:300px;" />
<button onclick="runAutoReplyWorkflow()" style="padding:8px 16px;">🤖 자동 응답 + 메일 전송</button>
<div id="workflowResult" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function runAutoReplyWorkflow() {
  const feedback = document.getElementById("workflowInput").value.trim();
  const email = document.getElementById("workflowEmail").value.trim();
  if (!feedback || !email) return alert("피드백과 이메일을 모두 입력해 주세요.");

  document.getElementById("workflowResult").innerText = "🧠 응답 생성 중...";

  const prompt = `
다음 고객 메시지에 대해 200자 이내로 정확하고 친절한 자동 응답을 생성하세요:
"${feedback}"
  `;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });

  const data = await res.json();
  const reply = data.choices[0].message.content;

  // Simulated email send
  document.getElementById("workflowResult").innerText = `✅ 자동 응답 생성 완료:\n${reply}\n📬 이메일 전송 중 (시뮬레이션)...`;
  setTimeout(() => {
    document.getElementById("workflowResult").innerText += `\n✅ ${email} 으로 전송 완료!`;
  }, 1500);
}
</script>

<hr style="margin:40px 0;">
<h2>🧠 클러스터별 대응 가이드 자동 생성</h2>
<button onclick="generateResponseGuides()" style="padding:8px 16px;">📚 가이드 생성</button>
<div id="clusterGuideResult" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function generateResponseGuides() {
  const data = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  const messages = data.slice(-12).map(d => `- ${d.msg}`).join("\n");
  if (!messages) return alert("분석할 응답이 없습니다.");

  document.getElementById("clusterGuideResult").innerText = "📖 가이드 생성 중...";

  const prompt = `
다음 고객 피드백들을 3~5개의 클러스터로 나눈 뒤, 각 클러스터별로 추천 대응 메시지를 작성해 주세요.
- 클러스터 이름
- 대표 키워드
- 추천 응답 템플릿 (150자 이내)

${messages}
  `;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });

  const result = await res.json();
  document.getElementById("clusterGuideResult").innerText = result.choices[0].message.content;
}
</script>


<hr style="margin:40px 0;">
<h2>🧾 자동 응답 템플릿 저장 및 재사용</h2>
<textarea id="templateInput" placeholder="응답 템플릿 작성" style="width:100%;height:60px;padding:8px;"></textarea>
<button onclick="saveReplyTemplate()" style="padding:8px 16px;">💾 템플릿 저장</button>
<button onclick="loadReplyTemplate()" style="padding:8px 16px;">📂 템플릿 불러오기</button>
<div id="templateStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function saveReplyTemplate() {
  const content = document.getElementById("templateInput").value.trim();
  if (!content) return alert("내용을 입력해 주세요.");
  localStorage.setItem("agrinexus_reply_template", content);
  document.getElementById("templateStatus").innerText = "✅ 템플릿 저장 완료";
}
function loadReplyTemplate() {
  const saved = localStorage.getItem("agrinexus_reply_template");
  if (saved) {
    document.getElementById("templateInput").value = saved;
    document.getElementById("templateStatus").innerText = "📂 템플릿 불러오기 완료";
  } else {
    document.getElementById("templateStatus").innerText = "⚠️ 저장된 템플릿이 없습니다.";
  }
}
</script>

<hr style="margin:40px 0;">
<h2>💬 자동 응답 SMS 전송 (시뮬레이션)</h2>
<input type="text" id="smsNumber" placeholder="수신자 휴대폰 번호" style="padding:8px;width:250px;" />
<button onclick="sendSMSSimulation()" style="padding:8px 16px;">📲 SMS 전송</button>
<div id="smsStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function sendSMSSimulation() {
  const number = document.getElementById("smsNumber").value.trim();
  if (!number) return alert("전화번호를 입력해 주세요.");
  document.getElementById("smsStatus").innerText = "📡 SMS 전송 중...";
  setTimeout(() => {
    document.getElementById("smsStatus").innerText = `✅ ${number} 로 SMS 전송 완료! (시뮬레이션)`;
  }, 1200);
}
</script>

<hr style="margin:40px 0;">
<h2>🧩 GPT 기반 자동 학습 응답 생성</h2>
<button onclick="generateAutoLearningReplies()" style="padding:8px 16px;">🧠 학습형 응답 생성</button>
<div id="aiLearningResult" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function generateAutoLearningReplies() {
  const data = JSON.parse(localStorage.getItem("agrinexus_crm") || "[]");
  const grouped = data.slice(-10).map(e => `고객: ${e.msg}`).join("\n");
  if (!grouped) return alert("학습할 피드백이 없습니다.");

  document.getElementById("aiLearningResult").innerText = "🧠 GPT 기반 학습 응답 생성 중...";

  const prompt = `
다음 고객 피드백 데이터를 참고하여,
반복적으로 나타나는 패턴이나 유형에 따라 AI 자동화 응답 템플릿을 생성해 주세요.
각 응답 유형별로 1~2줄 분량의 템플릿으로 정리해 주세요:

${grouped}
  `;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });

  const result = await res.json();
  document.getElementById("aiLearningResult").innerText = result.choices[0].message.content;
}
</script>


<hr style="margin:40px 0;">
<h2>📬 Twilio SMS API 연동 예시</h2>
<p>실제 문자 전송 API 구성 (Node.js 서버 필요)</p>
<pre style="background:#f4f4f4;padding:10px;font-size:0.8rem;">
const twilio = require('twilio');
const client = new twilio('ACCOUNT_SID', 'AUTH_TOKEN');

client.messages.create({
  body: 'AgriNexus 자동 응답입니다.',
  to: '+821012345678',
  from: '+12015551234'
}).then(msg => console.log(msg.sid));
</pre>

---

<h2>🧾 GPT 기반 템플릿 자동 분류 및 추천</h2>
<button onclick="analyzeTemplateCategories()" style="padding:8px 16px;">📚 템플릿 분류 및 추천</button>
<div id="templateCategoryOutput" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function analyzeTemplateCategories() {
  const stored = localStorage.getItem("agrinexus_reply_template") || "";
  if (!stored) return alert("저장된 템플릿이 없습니다.");
  document.getElementById("templateCategoryOutput").innerText = "🧠 템플릿 분석 중...";

  const prompt = `
다음 템플릿 메시지를 적절한 카테고리(문의/불만/칭찬/제안 등)로 분류하고, 유사한 추천 템플릿을 1~2개 제안해 주세요:

"${stored}"
  `;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });

  const result = await res.json();
  document.getElementById("templateCategoryOutput").innerText = result.choices[0].message.content;
}
</script>

<hr style="margin:40px 0;">
<h2>📅 예약 문자 전송 시뮬레이션</h2>
<input type="text" id="scheduledMsg" placeholder="전송할 메시지" style="padding:8px;width:80%;" />
<input type="number" id="delaySeconds" placeholder="몇 초 후 전송?" style="padding:8px;width:180px;" />
<button onclick="scheduleSMS()" style="padding:8px 16px;">⏰ 예약 전송 실행</button>
<div id="scheduledSMSResult" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function scheduleSMS() {
  const msg = document.getElementById("scheduledMsg").value.trim();
  const delay = parseInt(document.getElementById("delaySeconds").value.trim(), 10) * 1000;
  if (!msg || isNaN(delay)) return alert("메시지와 전송시간을 정확히 입력해 주세요.");

  document.getElementById("scheduledSMSResult").innerText = `⏳ ${delay / 1000}초 후 메시지 전송 예정...`;

  setTimeout(() => {
    document.getElementById("scheduledSMSResult").innerText = `✅ 메시지 전송 완료: "${msg}" (시뮬레이션)`;
  }, delay);
}
</script>


<hr style="margin:40px 0;">
<h2>📊 템플릿 사용 통계 분석</h2>
<button onclick="recordTemplateUse()" style="padding:8px 16px;">📈 사용 기록 추가</button>
<canvas id="templateUsageChart" width="400" height="200" style="margin-top:20px;"></canvas>

<script>
function recordTemplateUse() {
  const content = localStorage.getItem("agrinexus_reply_template") || "기본템플릿";
  const map = JSON.parse(localStorage.getItem("template_usage") || "{}");
  map[content] = (map[content] || 0) + 1;
  localStorage.setItem("template_usage", JSON.stringify(map));
  drawTemplateUsageChart();
}

function drawTemplateUsageChart() {
  const map = JSON.parse(localStorage.getItem("template_usage") || "{}");
  const labels = Object.keys(map);
  const data = labels.map(k => map[k]);
  const ctx = document.getElementById("templateUsageChart").getContext("2d");
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{ label: "템플릿 사용 횟수", data: data, backgroundColor: "#3f51b5" }]
    },
    options: { responsive: true, indexAxis: "y" }
  });
}
</script>

<hr style="margin:40px 0;">
<h2>📈 예약 문자 반복 전송 시뮬레이션</h2>
<input type="text" id="repeatMessage" placeholder="보낼 메시지" style="padding:8px;width:300px;" />
<input type="number" id="repeatCount" placeholder="반복 횟수" style="padding:8px;width:150px;" />
<input type="number" id="repeatDelay" placeholder="간격 (초)" style="padding:8px;width:150px;" />
<button onclick="scheduleRepeatingSMS()" style="padding:8px 16px;">🔁 반복 전송 시작</button>
<div id="repeatResult" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function scheduleRepeatingSMS() {
  const msg = document.getElementById("repeatMessage").value.trim();
  const count = parseInt(document.getElementById("repeatCount").value, 10);
  const delay = parseInt(document.getElementById("repeatDelay").value, 10) * 1000;
  if (!msg || isNaN(count) || isNaN(delay)) return alert("모든 값을 입력해 주세요.");

  document.getElementById("repeatResult").innerText = `🔁 총 ${count}회 전송 예정...`;

  for (let i = 0; i < count; i++) {
    setTimeout(() => {
      const log = document.getElementById("repeatResult").innerText;
      document.getElementById("repeatResult").innerText = `${log}\n✅ ${i + 1}회 전송 완료: "${msg}"`;
    }, delay * (i + 1));
  }
}
</script>

<hr style="margin:40px 0;">
<h2>🧠 템플릿 효과 자동 최적화 가이드 (GPT)</h2>
<button onclick="suggestTemplateImprovements()" style="padding:8px 16px;">📋 템플릿 개선 제안 받기</button>
<div id="templateImproveOutput" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function suggestTemplateImprovements() {
  const stored = localStorage.getItem("agrinexus_reply_template") || "";
  if (!stored) return alert("템플릿을 먼저 저장해 주세요.");
  document.getElementById("templateImproveOutput").innerText = "🧠 분석 중...";

  const prompt = `
다음 자동 응답 템플릿의 문장을 개선해 주세요.
- 전달력, 명확성, 공감도를 높이기 위해 간결하고 효과적인 문장으로 제안해 주세요.
- 200자 이내로 구성해 주세요.

"${stored}"
  `;

  const res = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer sk-abc123xyz456def..."
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });

  const result = await res.json();
  document.getElementById("templateImproveOutput").innerText = result.choices[0].message.content;
}
</script>


<hr style="margin:40px 0;">
<h2>🗺️ 실시간 사용자 활동 지도 시각화 (시뮬레이션)</h2>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Equirectangular-projection.jpg/640px-Equirectangular-projection.jpg" 
style="width:100%;max-width:600px;border:2px solid #ddd;" />
<p>🧭 사용자 접속 위치에 따라 붉은 원으로 시각화 가능 (향후 GeoIP 연동)</p>

---

<h2>🤖 AI 추천 기반 견적 자동 제안</h2>
<input type="text" id="quotePrompt" placeholder="상품명 + 수량 또는 요청 입력" style="width:100%;padding:8px;" />
<button onclick="generateSmartQuote()" style="padding:8px 16px;">📈 AI 견적 제안</button>
<div id="quoteSuggestion" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function generateSmartQuote() {
  const prompt = document.getElementById("quotePrompt").value.trim();
  if (!prompt) return alert("내용을 입력해 주세요.");
  document.getElementById("quoteSuggestion").innerText = "🧠 분석 중...";
  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Authorization": "Bearer sk-abc123xyz456def...",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: "다음 요청에 대해 견적을 추천해 주세요:\n" + prompt }]
    })
  });
  const data = await response.json();
  document.getElementById("quoteSuggestion").innerText = data.choices[0].message.content;
}
</script>

---

<h2>🧭 글로벌 수출입 요건 비교 시스템</h2>
<input type="text" id="exportCountry1" placeholder="국가 A (예: Korea)" style="padding:6px;width:200px;" />
<input type="text" id="exportCountry2" placeholder="국가 B (예: United States)" style="padding:6px;width:200px;" />
<button onclick="compareRequirements()" style="padding:8px 16px;">🌐 비교 실행</button>
<div id="compareExportResult" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function compareRequirements() {
  const a = document.getElementById("exportCountry1").value.trim();
  const b = document.getElementById("exportCountry2").value.trim();
  if (!a || !b) return alert("두 국가를 입력해 주세요.");
  document.getElementById("compareExportResult").innerText = "📊 비교 분석 중...";
  const prompt = `국가 ${a}와 ${b}의 수출입 요건, 통관 제도, 필요한 문서를 비교해 주세요.`;
  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Authorization": "Bearer sk-abc123xyz456def...",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });
  const data = await response.json();
  document.getElementById("compareExportResult").innerText = data.choices[0].message.content;
}
</script>

---

<h2>📋 계약서 자동 생성 마법사 (단계별)</h2>
<div>
  <input id="partyA" placeholder="당사자 A 이름" style="margin:5px;" />
  <input id="partyB" placeholder="당사자 B 이름" style="margin:5px;" />
  <input id="item" placeholder="거래 품목" style="margin:5px;" />
  <input id="amount" placeholder="수량 / 단가" style="margin:5px;" />
  <input id="terms" placeholder="인코텀즈 조건 (예: FOB)" style="margin:5px;" />
  <button onclick="generateContractWizard()" style="margin-top:10px;padding:8px 16px;">🧾 계약서 생성</button>
</div>
<div id="contractWizardOutput" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function generateContractWizard() {
  const a = document.getElementById("partyA").value;
  const b = document.getElementById("partyB").value;
  const item = document.getElementById("item").value;
  const amt = document.getElementById("amount").value;
  const terms = document.getElementById("terms").value;
  if (!a || !b || !item || !amt || !terms) return alert("모든 항목을 입력해 주세요.");
  document.getElementById("contractWizardOutput").innerText = "📋 계약서 생성 중...";
  const prompt = `다음 조건으로 계약서를 작성해 주세요:\n- 당사자: ${a} vs ${b}\n- 품목: ${item}\n- 수량/단가: ${amt}\n- 조건: ${terms}`;
  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Authorization": "Bearer sk-abc123xyz456def...",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });
  const data = await response.json();
  document.getElementById("contractWizardOutput").innerText = data.choices[0].message.content;
}
</script>


<hr style="margin:40px 0;">
<h2>🌍 실시간 GeoIP 사용자 국가 위치 추적 (시뮬레이션)</h2>
<button onclick="simulateGeoIP()" style="padding:8px 16px;">🌐 사용자 위치 조회</button>
<div id="geoIPOutput" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function simulateGeoIP() {
  document.getElementById("geoIPOutput").innerText = "📡 사용자 위치 조회 중...";
  try {
    const res = await fetch("https://ipapi.co/json/");
    const data = await res.json();
    const country = data.country_name;
    const ip = data.ip;
    document.getElementById("geoIPOutput").innerText = `🌎 접속 위치: ${country} (${ip})`;
  } catch {
    document.getElementById("geoIPOutput").innerText = "❌ 위치 정보를 불러올 수 없습니다.";
  }
}
</script>

<hr style="margin:40px 0;">
<h2>📤 견적/계약서 PDF 저장 및 이메일 전송 (시뮬레이션)</h2>
<textarea id="quoteOrContractText" placeholder="저장할 내용 입력" style="width:100%;height:80px;"></textarea>
<input type="email" id="emailTarget" placeholder="받는 이메일 주소" style="padding:8px;width:300px;" />
<button onclick="saveAndSendDoc()" style="padding:8px 16px;">📎 PDF 저장 + 메일 발송</button>
<div id="emailSendStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function saveAndSendDoc() {
  const content = document.getElementById("quoteOrContractText").value;
  const email = document.getElementById("emailTarget").value;
  if (!content || !email) return alert("내용과 이메일을 입력해 주세요.");
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  const lines = content.split("\n");
  lines.forEach((line, i) => pdf.text(line, 10, 10 + i * 10));
  pdf.save("AgriNexus_Document.pdf");
  document.getElementById("emailSendStatus").innerText = `✅ PDF 저장 완료 및 ${email}로 메일 전송됨 (시뮬레이션)`;
}
</script>

<hr style="margin:40px 0;">
<h2>📊 수출입 요건 비교 PDF 보고서 저장</h2>
<button onclick="saveExportComparePDF()" style="padding:8px 16px;">🧾 보고서 PDF 저장</button>
<div id="exportPDFStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function saveExportComparePDF() {
  const content = document.getElementById("compareExportResult").innerText;
  if (!content) return alert("먼저 국가 비교를 실행해 주세요.");
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  const lines = content.split("\n");
  lines.forEach((line, i) => pdf.text(line, 10, 10 + i * 10));
  pdf.save("Export_Requirement_Report.pdf");
  document.getElementById("exportPDFStatus").innerText = "✅ PDF 보고서 저장 완료";
}
</script>


<hr style="margin:40px 0;">
<h2>🧾 계약서 자동 버전 관리 시스템</h2>
<input type="text" id="contractVersionInput" placeholder="버전명 (예: v1.0, 2024-01)" style="padding:8px;width:200px;" />
<textarea id="contractVersionContent" placeholder="계약서 내용" style="width:100%;height:80px;padding:8px;"></textarea>
<button onclick="saveContractVersion()" style="padding:8px 16px;">💾 저장</button>
<select id="versionSelect" onchange="loadContractVersion()" style="margin-left:10px;padding:6px;"></select>
<div id="versionStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function saveContractVersion() {
  const key = document.getElementById("contractVersionInput").value.trim();
  const content = document.getElementById("contractVersionContent").value.trim();
  if (!key || !content) return alert("버전명과 내용을 입력해 주세요.");
  const versions = JSON.parse(localStorage.getItem("contract_versions") || "{}");
  versions[key] = content;
  localStorage.setItem("contract_versions", JSON.stringify(versions));
  updateVersionList();
  document.getElementById("versionStatus").innerText = `✅ ${key} 저장 완료`;
}

function updateVersionList() {
  const versions = JSON.parse(localStorage.getItem("contract_versions") || "{}");
  const select = document.getElementById("versionSelect");
  select.innerHTML = "";
  Object.keys(versions).forEach(k => {
    const opt = document.createElement("option");
    opt.value = k;
    opt.textContent = k;
    select.appendChild(opt);
  });
}

function loadContractVersion() {
  const key = document.getElementById("versionSelect").value;
  const versions = JSON.parse(localStorage.getItem("contract_versions") || "{}");
  document.getElementById("contractVersionContent").value = versions[key] || "";
  document.getElementById("versionStatus").innerText = `📂 ${key} 불러오기 완료`;
}

window.onload = updateVersionList;
</script>

<hr style="margin:40px 0;">
<h2>🌐 사용자 위치 기반 콘텐츠 자동 노출</h2>
<button onclick="detectAndShowLocale()" style="padding:8px 16px;">🌍 지역 콘텐츠 표시</button>
<div id="localeContent" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function detectAndShowLocale() {
  const res = await fetch("https://ipapi.co/json/");
  const data = await res.json();
  const country = data.country_name;
  let message = "🌎 글로벌 이용자입니다. 영어 페이지가 표시됩니다.";
  if (country === "Korea") message = "🇰🇷 한국 사용자입니다. 한국어 콘텐츠가 표시됩니다.";
  else if (country === "Japan") message = "🇯🇵 일본 사용자입니다. 일본어 콘텐츠가 표시됩니다.";
  else if (country === "China") message = "🇨🇳 중국 사용자입니다. 중국어 콘텐츠가 표시됩니다.";
  document.getElementById("localeContent").innerText = message;
}
</script>

<hr style="margin:40px 0;">
<h2>🗂 PDF 자동 분류 및 보관 시스템 (시뮬레이션)</h2>
<select id="pdfType" style="padding:6px;">
  <option value="contract">계약서</option>
  <option value="quote">견적서</option>
</select>
<textarea id="pdfContentInput" placeholder="PDF 내용 입력" style="width:100%;height:80px;padding:8px;"></textarea>
<button onclick="archivePDFByType()" style="padding:8px 16px;">📦 저장</button>
<div id="archiveStatus" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function archivePDFByType() {
  const type = document.getElementById("pdfType").value;
  const content = document.getElementById("pdfContentInput").value.trim();
  if (!content) return alert("내용을 입력해 주세요.");
  const key = `pdf_${type}_archive`;
  const list = JSON.parse(localStorage.getItem(key) || "[]");
  list.push({ content, saved: new Date().toISOString() });
  localStorage.setItem(key, JSON.stringify(list));
  document.getElementById("archiveStatus").innerText = `✅ ${type === "contract" ? "계약서" : "견적서"} 보관 완료`;
}
</script>


<hr style="margin:40px 0;">
<h2>📦 저장된 PDF 검색 및 다운로드</h2>
<select id="pdfSearchType" style="padding:6px;">
  <option value="contract">계약서</option>
  <option value="quote">견적서</option>
</select>
<button onclick="showSavedPDFs()" style="padding:8px 16px;">📂 저장 목록 보기</button>
<div id="pdfArchiveList" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function showSavedPDFs() {
  const type = document.getElementById("pdfSearchType").value;
  const key = `pdf_${type}_archive`;
  const list = JSON.parse(localStorage.getItem(key) || "[]");
  if (!list.length) {
    document.getElementById("pdfArchiveList").innerText = "⚠️ 저장된 문서가 없습니다.";
    return;
  }
  let out = list.map((e, i) => `📄 ${type} ${i+1} (저장시각: ${e.saved})\n내용 미리보기: ${e.content.substring(0, 50)}...`).join("\n");
  document.getElementById("pdfArchiveList").innerText = out;
}
</script>

<hr style="margin:40px 0;">
<h2>🔐 계약서 버전 변경 이력 기록</h2>
<button onclick="logVersionHistory()" style="padding:8px 16px;">📝 이력 기록 추가</button>
<div id="versionLogOutput" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
function logVersionHistory() {
  const version = document.getElementById("contractVersionInput").value.trim();
  const time = new Date().toISOString();
  const history = JSON.parse(localStorage.getItem("contract_version_log") || "[]");
  history.push({ version, time });
  localStorage.setItem("contract_version_log", JSON.stringify(history));
  const log = history.map(e => `📌 ${e.version} 저장됨 → ${e.time}`).join("\n");
  document.getElementById("versionLogOutput").innerText = log;
}
</script>

<hr style="margin:40px 0;">
<h2>🌍 지역 기반 가격/정책 자동 추천</h2>
<button onclick="suggestGeoPricing()" style="padding:8px 16px;">📈 지역 정책 제안</button>
<div id="geoPolicySuggestion" style="margin-top:10px;font-size:0.9rem;"></div>

<script>
async function suggestGeoPricing() {
  document.getElementById("geoPolicySuggestion").innerText = "📡 위치 기반 정책 분석 중...";
  const res = await fetch("https://ipapi.co/json/");
  const data = await res.json();
  const country = data.country_name;
  const prompt = `현재 사용자가 위치한 ${country}에 대해\n- 일반적인 수출입 비용\n- 문서 요건\n- 통관 절차\n- 추천 물류 정책을 요약해 주세요.`;
  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Authorization": "Bearer sk-abc123xyz456def...",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo",
      messages: [{ role: "user", content: prompt }]
    })
  });
  const dataOut = await response.json();
  document.getElementById("geoPolicySuggestion").innerText = dataOut.choices[0].message.content;
}
</script>

</body>






























</html>
